{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Verify MSVC Environment",
            "type": "shell",
            "command": "cmd",
            "args": [
                "/c",
                "\"C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Auxiliary\\Build\\vcvars32.bat\" && where cl.exe || (echo Error: cl.exe not found. Ensure Visual Studio 2022 Community is installed correctly at C:\\Program Files\\Microsoft Visual Studio\\2022\\Community. & exit /b 1)"
            ],
            "problemMatcher": [],
            "group": "none"
        },
        {
            "label": "Check OpenSSL Libraries",
            "type": "shell",
            "command": "cmd",
            "args": [
                "/c",
                "if not exist \"C:\\Program Files (x86)\\OpenSSL-Win32\\lib\\VC\\x86\\MDd\\libcrypto.lib\" (echo Error: libcrypto.lib not found & exit /b 1) && if not exist \"C:\\Program Files (x86)\\OpenSSL-Win32\\lib\\VC\\x86\\MDd\\libssl.lib\" (echo Error: libssl.lib not found & exit /b 1)"
            ],
            "problemMatcher": [],
            "group": "none",
            "dependsOn": ["Verify MSVC Environment"]
        },
        {
            "label": "Build libnfe",
            "type": "shell",
            "command": "cmd",
            "args": [
                "/c",
                "\"C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Auxiliary\\Build\\vcvars32.bat\" && cl /D_DEBUG /MDd /Zi /nologo /W3 /D_CRT_SECURE_NO_WARNINGS /I \"C:\\Program Files (x86)\\OpenSSL-Win32\\include\" /I \"${workspaceFolder}\\src\" \"${workspaceFolder}\\src\\libnfe.c\" /link /DLL /MACHINE:X86 /OUT:\"${workspaceFolder}\\build\\libnfe.dll\" /IMPLIB:\"${workspaceFolder}\\build\\libnfe.lib\" /LIBPATH:\"C:\\Program Files (x86)\\OpenSSL-Win32\\lib\\VC\\x86\\MDd\" libcrypto.lib libssl.lib"
            ],
            "problemMatcher": ["$msCompile"],
            "group": "build",
            "dependsOn": ["Check OpenSSL Libraries"]
        },
        {
            "label": "Build test_libnfe",
            "type": "shell",
            "command": "cmd",
            "args": [
                "/c",
                "\"C:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Auxiliary\\Build\\vcvars32.bat\" && cl /D_DEBUG /MDd /Zi /nologo /W3 /D_CRT_SECURE_NO_WARNINGS /I \"${workspaceFolder}\\src\" \"${workspaceFolder}\\test_libnfe.c\" /link /MACHINE:X86 /OUT:\"${workspaceFolder}\\build\\test_libnfe.exe\" /LIBPATH:\"${workspaceFolder}\\build\" \"${workspaceFolder}\\build\\libnfe.lib\" user32.lib"
            ],
            "problemMatcher": ["$msCompile"],
            "group": "build",
            "dependsOn": ["Build libnfe"]
        },
        {
            "label": "build",
            "type": "shell",
            "command": "echo Build completed successfully",
            "args": [],
            "problemMatcher": [],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "dependsOn": ["Build test_libnfe"],
            "dependsOrder": "sequence"
        },
        {
            "label": "Copy libnfe.dll",
            "type": "shell",
            "command": "cmd",
            "args": [
                "/c",
                "copy \"${workspaceFolder}\\build\\libnfe.dll\" \"C:\\madeiras\\erp\\libs\\libnfe.dll\" || (echo Error: Failed to copy libnfe.dll to C:\\madeiras\\erp\\libs & exit /b 1)"
            ],
            "problemMatcher": [],
            "group": "none",
            "dependsOn": ["build"]
        },
        {
            "label": "Run test_libnfe",
            "type": "shell",
            "command": "${workspaceFolder}\\test_libnfe.bat",
            "group": "test",
            "problemMatcher": [],
            "dependsOn": ["Copy libnfe.dll"],
            "dependsOrder": "sequence"
        }
    ]
}